# Мониторинг пути в шаре Windows
Этот простой скрипт проверяет доступность пути в шаре и возвращает 1 если доступна и 0 если не доступна.

## Установка
Для настройки работы скрипта вам нужно скопировать скрипт себе на Zabbix Server или Zabbix Proxy(в том случае если мониторинг осуществляться будет через прокси) по пути:  
```bash
cd check_windows_share_in_zabbix_by_python
cp check_share.py /usr/lib/zabbix/externalscripts/
```
Далее перейдем в нужную директорию, создадим виртуальное окружения Python и установим зависимости, чтобы не засорять системный интерпритатор.
```bash
cd /usr/lib/zabbix/externalscripts/
python3 -m venv venv
source venv/bin/activate
pip install pysmb
```
И сделаем скрипт исполняемым, что бы его можно было запускать напрямую, без указания оболочки(так его и будет запускать Zabbix)
```bash
chmod +x cp check_share.py
```

## Подготовка и настройка
Укажите ваши данные в переменных
```python
username = ''  # имя пользовтеля для доступа к шаре(рекомендую создать пользователя read-only)
password = ''  # пароль вашего пользователя
host = ''  # ip или dns сервера
share_name = ''  # имя шары
path_in_share = ''  # путь в шаре(то что мы и будем мониторить)
```
после запустите скрипт и он должен вернуть `1` если все сделано верно
```bash
./check_share.py
```

## Настройка в Zabbix
Создайте шаблон с именем `Windows share by Python`  
В шаблоне создайте `Элемент данных`: Check share - share_name, тип `Внешняя проверка`, ключ - это имя скрипта: `check_share.py`, Тип данных - Числовой(целое положительное), и выберите нужный вам интервал обновления. Так же в шаблоне вы можете создать Преобразование значний, например: `Доступность шары` и укажите значения: 0 -> Unavailable и 1 -> Available и в созданном элементе данных выберите это преобразование.

И создайте триггер, что бы вы знали если шара не доступна.
Имя триггера: Share is not available - share_name
Важность: на ваше усмотрение или Высокая
Выражение: `max(/Windows share by Python/check_share.py,#3)=0`
